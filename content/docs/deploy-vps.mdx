---
title: VPS 部署
description: VPS 部署
---

## 手动部署

### Github Deploy Key

添加 Github 部署密钥，见：[Github 部署密钥](./dev-github.mdx#添加-ssh-密钥到-github-项目仓库)

### 同步代码并构建

```bash
git clone git@github.com:kong0/next-maker.git next-maker
cd next-maker
pnpm install
pnpm build
pnpm start
```

### 通过 PM2 部署

```bash
# pm2 start pnpm --name "next-maker" -- start
pm2 start "pnpm start" --name "vpercentage"
pm2 save
pm2 startup
```

### Nginx

- 安装 Nginx
```bash
sudo apt update
sudo apt install nginx
```

- 配置 Nginx

> 配置文件路径：`/etc/nginx/sites-available/`

> 以 `a.com` 为例

`vi /etc/nginx/sites-available/a.com`


```nginx
server {
    listen 80;
    server_name a.com www.a.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

- 启用 Nginx 配置

```bash
sudo ln -s /etc/nginx/sites-available/a.com /etc/nginx/sites-enabled/
```

- 测试 Nginx 配置

```bash
sudo nginx -t
sudo systemctl restart nginx
```

- 查看 Nginx 状态

```bash
sudo systemctl status nginx
```

### SSL 证书

> Certbot 申请 SSL 证书（Let's Encrypt 免费证书）

#### 安装 Certbot

```bash
sudo apt install certbot python3-certbot-nginx
```

#### 获取 SSL 证书

> 确保 Nginx 已有 `a.com` 的域名配置，并指向 80 端口

```bash
sudo certbot --nginx -d a.com -d www.a.com
```
Certbot 会：

- 自动检测 Nginx 配置，申请证书
- 自动修改 Nginx 配置，启用 HTTPS

#### 自动续期

```bash
sudo certbot renew --dry-run
```

Let's Encrypt 的证书有效期 90 天，Certbot 会自动续签。

Ubuntu/Debian 安装 certbot 后自动有 cron 定时任务，不需要手动管理。

#### 查看证书状态

```bash
sudo certbot certificates
```

查看证书路径：`/etc/letsencrypt/live/a.com/`


### 防火墙配置(只允许 80 和 443 端口)

```bash
sudo ufw allow 80
sudo ufw allow 443
```

## 安全配置

Cloudflared Tunnel。